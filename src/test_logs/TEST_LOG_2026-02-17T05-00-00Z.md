---
agent: test-audit-agent
cadence: daily
run-start: 2026-02-17T05-00-00Z
prompt-path: src/prompts/daily/test-audit-agent.md
---
## Summary
- **Command**: npm test
- **Result**: Timeout (failed)
- **Incident ID**: TEST_TIMEOUT_20260217

## Log Entries






> torch-lock@0.1.0 test
> npm run validate:scheduler && npm run test:integration:e2e && node --test test/*.test.mjs tests/*.test.js


> torch-lock@0.1.0 validate:scheduler
> node scripts/validate-scheduler-roster.mjs && node scripts/validate-prompt-contract.mjs && node scripts/validate-scheduler-flow-parity.mjs && npm run validate:scheduler-failure-schema

Scheduler tables, roster, and prompt filenames are in sync.
Prompt contract validated for all daily/weekly prompts.
Scheduler flow parity validated for prompts and scheduler implementation.

> torch-lock@0.1.0 validate:scheduler-failure-schema
> node --test test/scheduler-lock-failure-schema.contract.test.mjs

TAP version 13
# Subtest: scheduler lock backend failure artifact matches required frontmatter schema
ok 1 - scheduler lock backend failure artifact matches required frontmatter schema
  ---
  duration_ms: 169.126196
  type: 'test'
  ...
# Subtest: schema contract catches missing required lock-backend field
ok 2 - schema contract catches missing required lock-backend field
  ---
  duration_ms: 1.908442
  type: 'test'
  ...
# Subtest: schema contract catches misnamed lock-backend key
ok 3 - schema contract catches misnamed lock-backend key
  ---
  duration_ms: 0.487997
  type: 'test'
  ...
1..3
# tests 3
# suites 0
# pass 3
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 253.972133

> torch-lock@0.1.0 test:integration:e2e
> node --test test/scheduler-preflight-lock.e2e.test.mjs

TAP version 13
# Subtest: lock preflight e2e: successful lock writes completed status snapshot
ok 1 - lock preflight e2e: successful lock writes completed status snapshot
  ---
  duration_ms: 432.181664
  type: 'test'
  ...
# Subtest: lock preflight e2e: exit code 2 quorum failure persists failed backend status and prompt-not-started marker
ok 2 - lock preflight e2e: exit code 2 quorum failure persists failed backend status and prompt-not-started marker
  ---
  duration_ms: 173.382095
  type: 'test'
  ...
# Subtest: lock preflight e2e: non-lock failure exits failed without prompt parse/schema classification
ok 3 - lock preflight e2e: non-lock failure exits failed without prompt parse/schema classification
  ---
  duration_ms: 83.274948
  type: 'test'
  ...
1..3
# tests 3
# suites 0
# pass 3
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 768.027804
TAP version 13
# Subtest: Build artifacts verification
    # Subtest: dist directory exists
    not ok 1 - dist directory exists
      ---
      duration_ms: 2.773862
      type: 'test'
      location: '/app/test/build_verification.test.mjs:9:11'
      failureType: 'testCodeFailure'
      error: |-
        dist directory should exist

        false !== true

      code: 'ERR_ASSERTION'
      name: 'AssertionError'
      expected: true
      actual: false
      operator: 'strictEqual'
      stack: |-
        TestContext.<anonymous> (file:///app/test/build_verification.test.mjs:10:12)
        Test.runInAsyncScope (node:async_hooks:214:14)
        Test.run (node:internal/test_runner/test:1047:25)
        Test.start (node:internal/test_runner/test:944:17)
        TestContext.test (node:internal/test_runner/test:373:20)
        TestContext.<anonymous> (file:///app/test/build_verification.test.mjs:9:11)
        Test.runInAsyncScope (node:async_hooks:214:14)
        Test.run (node:internal/test_runner/test:1047:25)
        Test.start (node:internal/test_runner/test:944:17)
        startSubtestAfterBootstrap (node:internal/test_runner/harness:296:17)
      ...
    # Subtest: Critical files exist in dist
    not ok 2 - Critical files exist in dist
      ---
      duration_ms: 0.642383
      type: 'test'
      location: '/app/test/build_verification.test.mjs:13:11'
      failureType: 'testCodeFailure'
      error: |-
        File index.html should exist in dist

        false !== true

      code: 'ERR_ASSERTION'
      name: 'AssertionError'
      expected: true
      actual: false
      operator: 'strictEqual'
      stack: |-
        file:///app/test/build_verification.test.mjs:25:14
        Array.forEach (<anonymous>)
        TestContext.<anonymous> (file:///app/test/build_verification.test.mjs:23:19)
        Test.runInAsyncScope (node:async_hooks:214:14)
        Test.run (node:internal/test_runner/test:1047:25)
        Test.start (node:internal/test_runner/test:944:17)
        TestContext.test (node:internal/test_runner/test:373:20)
        TestContext.<anonymous> (file:///app/test/build_verification.test.mjs:13:11)
        async Test.run (node:internal/test_runner/test:1054:7)
        async startSubtestAfterBootstrap (node:internal/test_runner/harness:296:3)
      ...
    # Subtest: TORCH.md content is not empty
    not ok 3 - TORCH.md content is not empty
      ---
      duration_ms: 0.330603
      type: 'test'
      location: '/app/test/build_verification.test.mjs:29:11'
      failureType: 'testCodeFailure'
      error: "ENOENT: no such file or directory, open '/app/dist/src/docs/TORCH.md'"
      code: 'ENOENT'
      stack: |-
        Object.readFileSync (node:fs:440:20)
        TestContext.<anonymous> (file:///app/test/build_verification.test.mjs:31:24)
        Test.runInAsyncScope (node:async_hooks:214:14)
        Test.run (node:internal/test_runner/test:1047:25)
        Test.start (node:internal/test_runner/test:944:17)
        TestContext.test (node:internal/test_runner/test:373:20)
        TestContext.<anonymous> (file:///app/test/build_verification.test.mjs:29:11)
        async Test.run (node:internal/test_runner/test:1054:7)
        async startSubtestAfterBootstrap (node:internal/test_runner/harness:296:3)
      ...
    1..3
not ok 1 - Build artifacts verification
  ---
  duration_ms: 6.149943
  type: 'test'
  location: '/app/test/build_verification.test.mjs:8:1'
  failureType: 'subtestsFailed'
  error: '3 subtests failed'
  code: 'ERR_TEST_FAILURE'
  ...
# Subtest: parseArgs should parse basic command
ok 2 - parseArgs should parse basic command
  ---
  duration_ms: 1.629739
  type: 'test'
  ...
# Subtest: parseArgs should parse agent and cadence
ok 3 - parseArgs should parse agent and cadence
  ---
  duration_ms: 0.391176
  type: 'test'
  ...
# Subtest: parseArgs should parse equals sign syntax
ok 4 - parseArgs should parse equals sign syntax
  ---
  duration_ms: 1.768759
  type: 'test'
  ...
# Subtest: parseArgs should parse dry-run flag
ok 5 - parseArgs should parse dry-run flag
  ---
  duration_ms: 0.349862
  type: 'test'
  ...
# Subtest: parseArgs should parse port with default
ok 6 - parseArgs should parse port with default
  ---
  duration_ms: 0.212822
  type: 'test'
  ...
# Subtest: parseArgs should parse custom port
ok 7 - parseArgs should parse custom port
  ---
  duration_ms: 0.222727
  type: 'test'
  ...
# Subtest: parseArgs should parse ignore-logs flag
ok 8 - parseArgs should parse ignore-logs flag
  ---
  duration_ms: 0.274233
  type: 'test'
  ...
# Subtest: parseArgs should parse memory flags
ok 9 - parseArgs should parse memory flags
  ---
  duration_ms: 1.125391
  type: 'test'
  ...
# Subtest: parseArgs should parse memory flags with equals
ok 10 - parseArgs should parse memory flags with equals
  ---
  duration_ms: 0.574314
  type: 'test'
  ...
# Subtest: src/lib.mjs
    # Subtest: cmdCheck
        # Subtest: returns correct structure with empty locks
        ok 1 - returns correct structure with empty locks
          ---
          duration_ms: 2.813
          type: 'test'
          ...
        # Subtest: identifies locked agents
        ok 2 - identifies locked agents
          ---
          duration_ms: 0.560464
          type: 'test'
          ...
        # Subtest: excludes paused agents
        ok 3 - excludes paused agents
          ---
          duration_ms: 0.603289
          type: 'test'
          ...
        # Subtest: identifies unknown locked agents
        ok 4 - identifies unknown locked agents
          ---
          duration_ms: 0.663045
          type: 'test'
          ...
        1..4
    ok 1 - cmdCheck
      ---
      duration_ms: 5.832963
      type: 'suite'
      ...
    # Subtest: cmdLock
        # Subtest: successfully locks an available agent
        ok 1 - successfully locks an available agent
          ---
          duration_ms: 13.125278
          type: 'test'
          ...
        # Subtest: fails if agent is not in roster
        ok 2 - fails if agent is not in roster
          ---
          duration_ms: 1.21686
          type: 'test'
          ...
        # Subtest: fails if agent is already locked
        ok 3 - fails if agent is already locked
          ---
          duration_ms: 0.496428
          type: 'test'
          ...
        # Subtest: fails if agent is already completed
        ok 4 - fails if agent is already completed
          ---
          duration_ms: 0.805554
          type: 'test'
          ...
        # Subtest: fails if race check is lost
        ok 5 - fails if race check is lost
          ---
          duration_ms: 2.971181
          type: 'test'
          ...
        # Subtest: handles race condition with identical timestamps using eventId tie-breaker (we win)
        ok 6 - handles race condition with identical timestamps using eventId tie-breaker (we win)
          ---
          duration_ms: 14.934003
          type: 'test'
          ...
        # Subtest: handles race condition with identical timestamps using eventId tie-breaker (we lose)
        ok 7 - handles race condition with identical timestamps using eventId tie-breaker (we lose)
          ---
          duration_ms: 2.497348
          type: 'test'
          ...
        # Subtest: dry run does not publish
        ok 8 - dry run does not publish
          ---
          duration_ms: 0.43071
          type: 'test'
          ...
        1..8
    ok 2 - cmdLock
      ---
      duration_ms: 37.60504
      type: 'suite'
      ...
    # Subtest: cmdList
        # Subtest: lists active locks
        ok 1 - lists active locks
          ---
          duration_ms: 0.775642
          type: 'test'
          ...
        # Subtest: warns about unknown agents
        ok 2 - warns about unknown agents
          ---
          duration_ms: 0.365213
          type: 'test'
          ...
        # Subtest: handles no locks
        ok 3 - handles no locks
          ---
          duration_ms: 0.448003
          type: 'test'
          ...
        1..3
    ok 3 - cmdList
      ---
      duration_ms: 1.81943
      type: 'suite'
      ...
    # Subtest: cmdComplete
        # Subtest: successfully completes an active lock
        ok 1 - successfully completes an active lock
          ---
          duration_ms: 1.979184
          type: 'test'
          ...
        # Subtest: fails if no active lock found
        ok 2 - fails if no active lock found
          ---
          duration_ms: 0.375617
          type: 'test'
          ...
        # Subtest: detects already completed task
        ok 3 - detects already completed task
          ---
          duration_ms: 0.305841
          type: 'test'
          ...
        1..3
    ok 4 - cmdComplete
      ---
      duration_ms: 2.875483
      type: 'suite'
      ...
    1..4
ok 11 - src/lib.mjs
  ---
  duration_ms: 49.102583
  type: 'suite'
  ...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
#   Published to 1/3 relays (required=1, timeout=25ms)
# [publish:primary] Publishing to 2 relays (wss://relay-a, wss://relay-b)...
# [publish:primary] Publishing to 2 relays (wss://relay-a, wss://relay-b)...
#   Published to 2/2 relays (required=2, timeout=25ms)
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
# [publish:primary] Publishing to 3 relays (wss://relay-a, wss://relay-b, wss://relay-c)...
#   Published to 2/3 relays (required=2, timeout=25ms)
# (node:3058) ExperimentalWarning: The MockTimers API is an experimental feature and might change at any time
# (Use `node --trace-warnings ...` to show where the warning was created)
# Subtest: ci-resilience lock acquisition under unstable relays
    # Subtest: recovers after all relays are down for an initial outage window
    ok 1 - recovers after all relays are down for an initial outage window
      ---
      duration_ms: 21.380814
      type: 'test'
      ...
    # Subtest: survives intermittent timeout spikes and reaches quorum with bounded retries
    ok 2 - survives intermittent timeout spikes and reaches quorum with bounded retries
      ---
      duration_ms: 3.038434
      type: 'test'
      ...
    # Subtest: handles staggered relay recovery and never exceeds retry budget
    ok 3 - handles staggered relay recovery and never exceeds retry budget
      ---
      duration_ms: 3.598744
      type: 'test'
      ...
    1..3
ok 12 - ci-resilience lock acquisition under unstable relays
  ---
  duration_ms: 29.816422
  type: 'suite'
  ...
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
#   Published to 1/1 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
#   Published to 1/1 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
# [publish:primary] Publishing to 1 relays (wss://relay-a)...
# (node:3059) ExperimentalWarning: The MockTimers API is an experimental feature and might change at any time
# (Use `node --trace-warnings ...` to show where the warning was created)
# Subtest: publishLock retry behavior
    # Subtest: succeeds immediately on first attempt without retries
    ok 1 - succeeds immediately on first attempt without retries
      ---
      duration_ms: 5.526423
      type: 'test'
      ...
    # Subtest: retries a transient failure then succeeds within retry budget with bounded jitter
    ok 2 - retries a transient failure then succeeds within retry budget with bounded jitter
      ---
      duration_ms: 2.566932
      type: 'test'
      ...
    # Subtest: returns terminal relay_publish_quorum_failure after exhausting retry budget
    ok 3 - returns terminal relay_publish_quorum_failure after exhausting retry budget
      ---
      duration_ms: 4.26056
      type: 'test'
      ...
    # Subtest: short-circuits non-retryable failures without extra attempts
    ok 4 - short-circuits non-retryable failures without extra attempts
      ---
      duration_ms: 1.915861
      type: 'test'
      ...
    1..4
ok 13 - publishLock retry behavior
  ---
  duration_ms: 15.987927
  type: 'suite'
  ...
# [publish:primary] Publishing to 2 relays (wss://primary-a, wss://primary-b)...
# [publish:primary] Publishing to 2 relays (wss://primary-a, wss://primary-b)...
#   Published to 2/2 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 1 relays (wss://primary-down)...
# [publish:primary] Publishing to 1 relays (wss://primary-down)...
# [publish:primary] Publishing to 1 relays (wss://primary-down)...
# [publish:primary] Publishing to 1 relays (wss://primary-bad)...
# [publish:primary] Publishing to 5 relays (relay-timeout, wss://dns, wss://tcp, wss://tls, wss://ws)...
# [publish:primary] Publishing to 2 relays (wss://relay-bad, wss://relay-ok)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"elapsedMs":1}],"totalElapsedMs":1}
#   Published to 1/2 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 1 relays (wss://primary-bad)...
# [publish:fallback] Publishing to 1 relays (wss://fallback-ok)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"elapsedMs":0}],"totalElapsedMs":0}
#   Published to 1/2 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 2 relays (wss://bad, wss://healthy)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"elapsedMs":0}],"totalElapsedMs":0}
#   Published to 1/2 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 2 relays (wss://healthy, wss://bad)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":2,"elapsedMs":0}],"totalElapsedMs":0}
#   Published to 1/2 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 1 relays (wss://healthy)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":1,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":1,"elapsedMs":0}],"totalElapsedMs":0}
#   Published to 1/1 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 1 relays (wss://healthy)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":1,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":1,"elapsedMs":0}],"totalElapsedMs":0}
#   Published to 1/1 relays (required=1, timeout=200ms)
# [publish:primary] Publishing to 2 relays (wss://primary-a, wss://primary-b)...
# [publish:fallback] Publishing to 1 relays (wss://fallback-healthy)...
# {"event":"lock_publish_quorum_met","correlationId":"none","attemptId":"1","publishAttempt":1,"successCount":1,"relayAttemptedCount":3,"requiredSuccesses":1,"timeoutMs":200,"retryTimeline":[{"publishAttempt":1,"successCount":1,"relayAttemptedCount":3,"elapsedMs":0}],"totalElapsedMs":0}
#   Published to 1/3 relays (required=1, timeout=200ms)
# Subtest: lock-ops
    # Subtest: parseLockEvent
        # Subtest: parses a valid lock event correctly
        ok 1 - parses a valid lock event correctly
          ---
          duration_ms: 1.520633
          type: 'test'
          ...
        1..1
    ok 1 - parseLockEvent
      ---
      duration_ms: 2.588956
      type: 'suite'
      ...
    # Subtest: queryLocks
        # Subtest: falls back to fallback relays when primary query fails
        ok 1 - falls back to fallback relays when primary query fails
          ---
          duration_ms: 16.038964
          type: 'test'
          ...
        1..1
    ok 2 - queryLocks
      ---
      duration_ms: 16.207848
      type: 'suite'
      ...
    # Subtest: publishLock
        # Subtest: retries transient failures and succeeds on a later attempt
        ok 1 - retries transient failures and succeeds on a later attempt
          ---
          duration_ms: 6.263243
          type: 'test'
          ...
        # Subtest: fails after retry budget is exhausted for persistent transient failures
        ok 2 - fails after retry budget is exhausted for persistent transient failures
          ---
          duration_ms: 2.56509
          type: 'test'
          ...
        # Subtest: fails without retry for persistent validation failures
        ok 3 - fails without retry for persistent validation failures
          ---
          duration_ms: 1.253336
          type: 'test'
          ...
        # Subtest: includes per-relay reason categories and retry metadata in failure diagnostics
        ok 4 - includes per-relay reason categories and retry metadata in failure diagnostics
          ---
          duration_ms: 1.869107
          type: 'test'
          ...
        # Subtest: returns success when mixed relay outcomes still satisfy quorum
        ok 5 - returns success when mixed relay outcomes still satisfy quorum
          ---
          duration_ms: 1.415172
          type: 'test'
          ...
        # Subtest: uses fallback relays to satisfy min success quorum
        ok 6 - uses fallback relays to satisfy min success quorum
          ---
          duration_ms: 1.251327
          type: 'test'
          ...
        # Subtest: quarantines repeatedly failing relays and still reaches quorum with one healthy relay
        ok 7 - quarantines repeatedly failing relays and still reaches quorum with one healthy relay
          ---
          duration_ms: 1.857181
          type: 'test'
          ...
        # Subtest: uses fallback and min active pool to reintroduce quarantined relay when needed
        ok 8 - uses fallback and min active pool to reintroduce quarantined relay when needed
          ---
          duration_ms: 1.019829
          type: 'test'
          ...
        1..8
    ok 3 - publishLock
      ---
      duration_ms: 18.454048
      type: 'suite'
      ...
    1..3
ok 14 - lock-ops
  ---
  duration_ms: 38.273317
  type: 'suite'
  ...
# memory_telemetry {
#   event: 'memory:ingested',
#   payload: {
#     memory_id: 'bbc3abeb-2068-44aa-8043-402c412920c8',
#     agent_id: 'agent-telemetry',
#     dedupe_key: 'd0a9b6d797995692923d3a75507031c42d4a454250da2524a86ce5325caa06c5',
#     chunk_events: 1,
#     window_start: 0,
#     window_end: 1771338458910
#   },
#   ts: 1771338458915
# }
# memory_metric {
#   metric: 'memory_ingested_total',
#   payload: { count: 1 },
#   ts: 1771338458916
# }
# memory_metric {
#   metric: 'memory_retrieved_total',
#   payload: { count: 3, cache_hit: false },
#   ts: 1771338458919
# }
# memory_telemetry {
#   event: 'memory:pruned',
#   payload: { pruned_count: 1, retention_ms: 1000, dry_run: true },
#   ts: 1771338458920
# }
# memory_metric {
#   metric: 'memory_pruned_total',
#   payload: { count: 0, retention_ms: 1000, dry_run: true },
#   ts: 1771338458920
# }
# memory_telemetry {
#   event: 'memory:prune_skipped',
#   payload: { reason: 'flag_disabled', retention_ms: 1000 },
#   ts: 1771338458920
# }
# Subtest: listMemories, inspectMemory, pinMemory, and unpinMemory support admin hooks
ok 15 - listMemories, inspectMemory, pinMemory, and unpinMemory support admin hooks
  ---
  duration_ms: 4.735708
  type: 'test'
  ...
# Subtest: triggerPruneDryRun returns candidate metadata without deleting records
ok 16 - triggerPruneDryRun returns candidate metadata without deleting records
  ---
  duration_ms: 0.522234
  type: 'test'
  ...
# Subtest: memoryStats reports counts/rates and retrieval telemetry remains redaction-safe
ok 17 - memoryStats reports counts/rates and retrieval telemetry remains redaction-safe
  ---
  duration_ms: 9.753963
  type: 'test'
  ...
# Subtest: runPruneCycle respects prune feature-flag modes
ok 18 - runPruneCycle respects prune feature-flag modes
  ---
  duration_ms: 1.418153
  type: 'test'
  ...
# Subtest: stores runtime events in signer/session namespace and clears scope
ok 19 - stores runtime events in signer/session namespace and clears scope
  ---
  duration_ms: 2.637394
  type: 'test'
  ...
# Subtest: expires runtime events and records expiration metrics
ok 20 - expires runtime events and records expiration metrics
  ---
  duration_ms: 11.365161
  type: 'test'
  ...
# Subtest: enforces LRU bounds and tracks eviction metrics
ok 21 - enforces LRU bounds and tracks eviction metrics
  ---
  duration_ms: 0.540305
  type: 'test'
  ...
# Subtest: blocks decrypted/session-sensitive data from durable promotion without sanitizer pass
ok 22 - blocks decrypted/session-sensitive data from durable promotion without sanitizer pass
  ---
  duration_ms: 0.406625
  type: 'test'
  ...
# Subtest: createEmbedderAdapter selects in-memory backend and supports vector CRUD
ok 23 - createEmbedderAdapter selects in-memory backend and supports vector CRUD
  ---
  duration_ms: 1.598046
  type: 'test'
  ...
# Subtest: createEmbedderAdapter reads backend from environment
ok 24 - createEmbedderAdapter reads backend from environment
  ---
  duration_ms: 0.487329
  type: 'test'
  ...
# Subtest: memory feature flags parse defaults and canary allow-lists
ok 25 - memory feature flags parse defaults and canary allow-lists
  ---
  duration_ms: 1.316392
  type: 'test'
  ...
# Subtest: memory prune flag supports off, dry-run, and active modes
ok 26 - memory prune flag supports off, dry-run, and active modes
  ---
  duration_ms: 0.297343
  type: 'test'
  ...
# Subtest: ingestMemoryWindow gathers sources, redacts pii, chunks, embeds, links, and emits telemetry
ok 27 - ingestMemoryWindow gathers sources, redacts pii, chunks, embeds, links, and emits telemetry
  ---
  duration_ms: 5.895552
  type: 'test'
  ...
# Subtest: ingestMemoryWindow dedupes overlapping windows by hashed content + agent + timestamp bucket
ok 28 - ingestMemoryWindow dedupes overlapping windows by hashed content + agent + timestamp bucket
  ---
  duration_ms: 0.777377
  type: 'test'
  ...
# Subtest: createLifecyclePlan respects delete safety constraints and logs reasons
ok 29 - createLifecyclePlan respects delete safety constraints and logs reasons
  ---
  duration_ms: 2.55324
  type: 'test'
  ...
# Subtest: createLifecyclePlan condenses near-duplicates and archives merged source records
ok 30 - createLifecyclePlan condenses near-duplicates and archives merged source records
  ---
  duration_ms: 0.942274
  type: 'test'
  ...
# Subtest: applyLifecycleActions executes keep/archive/delete and merge markers
ok 31 - applyLifecycleActions executes keep/archive/delete and merge markers
  ---
  duration_ms: 1.407718
  type: 'test'
  ...
# Subtest: filterAndRankMemories applies metadata filters and composite score
ok 32 - filterAndRankMemories applies metadata filters and composite score
  ---
  duration_ms: 2.804092
  type: 'test'
  ...
# Subtest: formatMemoriesForPrompt returns prompt blocks and enforces token budget trimming
ok 33 - formatMemoriesForPrompt returns prompt blocks and enforces token budget trimming
  ---
  duration_ms: 2.977728
  type: 'test'
  ...
# Subtest: isMemoryRetrievalEnabled supports global toggle and agent canary list
ok 34 - isMemoryRetrievalEnabled supports global toggle and agent canary list
  ---
  duration_ms: 0.422558
  type: 'test'
  ...
# Subtest: renderPromptWithMemoryContext injects bounded memory block before base prompt
ok 35 - renderPromptWithMemoryContext injects bounded memory block before base prompt
  ---
  duration_ms: 0.781059
  type: 'test'
  ...
# Subtest: createDbAdvisoryLockProvider acquires and releases postgres advisory locks
ok 36 - createDbAdvisoryLockProvider acquires and releases postgres advisory locks
  ---
  duration_ms: 2.371921
  type: 'test'
  ...
# Subtest: startMemoryMaintenanceScheduler runs all jobs and emits metrics including retries
ok 37 - startMemoryMaintenanceScheduler runs all jobs and emits metrics including retries
  ---
  duration_ms: 27.370381
  type: 'test'
  ...
# Subtest: startMemoryMaintenanceScheduler skips jobs when feature flags disable memory
ok 38 - startMemoryMaintenanceScheduler skips jobs when feature flags disable memory
  ---
  duration_ms: 11.944884
  type: 'test'
  ...
# Subtest: normalizeMemoryItem applies durable schema defaults and coercions
ok 39 - normalizeMemoryItem applies durable schema defaults and coercions
  ---
  duration_ms: 2.539095
  type: 'test'
  ...
# Subtest: validateMemoryItem reports field-level errors
ok 40 - validateMemoryItem reports field-level errors
  ---
  duration_ms: 0.541957
  type: 'test'
  ...
# Subtest: ingestEvents rejects invalid writes and logs structured validation details
ok 41 - ingestEvents rejects invalid writes and logs structured validation details
  ---
  duration_ms: 6.072232
  type: 'test'
  ...
# Subtest: loadMemoryPromptTemplates loads all memory prompt templates from disk
ok 42 - loadMemoryPromptTemplates loads all memory prompt templates from disk
  ---
  duration_ms: 1.516098
  type: 'test'
  ...
# Subtest: summarizeEvents retries with repair prompt when first response is malformed JSON
ok 43 - summarizeEvents retries with repair prompt when first response is malformed JSON
  ---
  duration_ms: 2.104265
  type: 'test'
  ...
# Subtest: summarizeEvents falls back to deterministic minimal summary with conservative importance when parsing fails twice
ok 44 - summarizeEvents falls back to deterministic minimal summary with conservative importance when parsing fails twice
  ---
  duration_ms: 1.71858
  type: 'test'
  ...
# Subtest: CLI Smoke Test
    # Subtest: should print usage when no args provided
    ok 1 - should print usage when no args provided
      ---
      duration_ms: 152.239899
      type: 'test'
      ...
    # Subtest: should fail when checking without cadence
    ok 2 - should fail when checking without cadence
      ---
      duration_ms: 152.611192
      type: 'test'
      ...
    # Subtest: should include paused agents in check output
    ok 3 - should include paused agents in check output
      ---
      duration_ms: 998.653388
      type: 'test'
      ...
    1..3
ok 45 - CLI Smoke Test
  ---
  duration_ms: 1307.026916
  type: 'suite'
  ...
