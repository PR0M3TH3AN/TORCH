# Decompose Agent: Context

## File Selection
- **File:** `scripts/agent/run-scheduler-cycle.mjs`
- **Reason:** Largest grandfathered JS source file (1160 lines) that is suitable for structural decomposition. Other larger files are HTML or JSON.
- **Commit:** `HEAD`

## Extraction Plan
We will extract three cohesive modules from `scripts/agent/run-scheduler-cycle.mjs` to reduce its size and improve maintainability.

### 1. Scheduler Configuration (`scripts/agent/scheduler-config.mjs`)
- **Functions to extract:**
  - `parseArgs`
  - `getSchedulerConfig`
  - `resolveNodeCommand` (internal helper within `getSchedulerConfig` - might need to be a module-level helper or kept inside)
  - Constants: `VALID_CADENCES`

### 2. Scheduler Logger (`scripts/agent/scheduler-logger.mjs`)
- **Functions to extract:**
  - `writeLog`
  - `printRunSummary`
  - `exitWithSummary`
  - `categorizeFailureMetadata`
  - `ts` (timestamp helper)

### 3. Scheduler State (`scripts/agent/scheduler-state.mjs`)
- **Functions to extract:**
  - `readRunState`
  - `writeRunState`
  - `createIdempotencyKey`

## Refactoring Strategy
1. Create new module files with necessary imports (fs, path, utils).
2. Export the identified functions.
3. Update `scripts/agent/run-scheduler-cycle.mjs` to import these functions.
4. Verify behavior with linting and dry-run.
