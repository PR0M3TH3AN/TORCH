# Context: Decompose scripts/agent/run-scheduler-cycle.mjs

- **Chosen File**: `scripts/agent/run-scheduler-cycle.mjs`
- **Line Count**: 1127 lines
- **Reason**: Largest source file in the repository (excluding generated/vendored/test logs). No substantial refactor found in recent history (last commit was a merge).
- **Goal**: Reduce file size by extracting cohesive blocks into new modules.
- **Node Version**: v22.22.0 (as seen in `npm run lock:check:daily` output previously)
- **Extraction Plan**:
  1.  Extract low-level utilities to `scripts/agent/scheduler-utils.mjs`.
  2.  Extract lock-related logic to `scripts/agent/scheduler-lock.mjs`.

## Proposed Extractions

### 1. `scripts/agent/scheduler-utils.mjs`
This will house generic helpers used throughout the script, reducing the noise in the main logic.
- `runCommand`
- `getSafeEnv`
- `sleep`
- `parseJsonFromOutput`
- `parseJsonEventsFromOutput`
- `redactSensitive`
- `excerptText`
- `parseNonNegativeInt`
- `parseBooleanFlag`
- `readJson`
- `normalizeStringList`

### 2. `scripts/agent/scheduler-lock.mjs`
This will encapsulate the complex locking logic.
- `acquireLockWithRetry`
- `summarizeLockFailureReasons`
- `classifyLockBackendError`
- `buildLockBackendRemediation`
- `runLockHealthPreflight`
