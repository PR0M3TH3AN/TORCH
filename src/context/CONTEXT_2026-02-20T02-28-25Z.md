# Context: Decompose src/lock-ops.mjs

## File Selection
- **File:** `src/lock-ops.mjs`
- **Size:** 881 lines (Excess: 581 lines)
- **Selection Reason:** Single largest grandfathered source file available for decomposition.
- **Recent History:** Last significant commit was a merge (`e1052814`). No recent decomposition or major refactor found in `git log`.

## Decomposition Plan
The file contains three major cohesive blocks:
1. **RelayHealthManager**: A class for tracking relay health, scoring, and metrics.
2. **LockPublisher**: A class for publishing lock events with retries and fallback logic.
3. **Lock Operations**: The core `queryLocks` and `parseLockEvent` logic.

### Extraction Strategy
1. **Extract `RelayHealthManager`** into `src/relay-health-manager.mjs`.
   - Includes: `RelayHealthManager` class, `defaultHealthManager` instance, `summarizeRelayMetrics`, `computeRelayScore`, `buildRelayHealthConfig`.
   - Exports: `RelayHealthManager`, `defaultHealthManager`, `buildRelayHealthConfig`.

2. **Extract `LockPublisher`** into `src/lock-publisher.mjs`.
   - Includes: `LockPublisher` class, `publishLock`, `publishToRelays`.
   - Includes: `classifyPublishError` and related constants (`PUBLISH_ERROR_CODES`, `PUBLISH_FAILURE_CATEGORIES`).
   - Includes: `secureRandom`, `calculateBackoffDelayMs`.
   - Internal Helpers (duplicated): `withTimeout`, `relayListLabel`.
   - Exports: `publishLock`, `LockPublisher`.

3. **Refactor `src/lock-ops.mjs`**.
   - Import `defaultHealthManager`, `buildRelayHealthConfig`, `publishLock`.
   - Remove extracted code.
   - Retain `queryLocks`, `parseLockEvent`, `filterActiveLocks`.
   - Retain `withTimeout` and `relayListLabel` (for local use).

## Goal
Reduce `src/lock-ops.mjs` by > 200 lines.
