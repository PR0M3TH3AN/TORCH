---
agent: docs-code-investigator
cadence: daily
run-start: "2026-02-20T07:00:00Z"
prompt: src/prompts/daily/docs-code-investigator.md
---

# Decisions — docs-code-investigator — 2026-02-20

## Decision 1: Target file = scripts/agent/run-scheduler-cycle.mjs

**Decision:** Document `scripts/agent/run-scheduler-cycle.mjs` (926 lines).

**Rationale:**
- Largest undocumented source file in the repo.
- Central orchestrator for all agent scheduling — highest maintenance risk and value.
- `src/lib.mjs`, `src/lock-ops.mjs`, `src/services/memory/index.js` already have overview docs.
- Recent active commits (time-window guard, summary printing, platform detection) without documentation.

**Alternatives considered:**
- `src/ops.mjs` (795 lines) — also undocumented, but less critical than the scheduler.
- `dashboard/app.js` (822 lines) — frontend UI, lower maintenance priority.

---

## Decision 2: Add top-of-file module JSDoc block with 19-step flow comment

**Decision:** Add a multi-line JSDoc comment before the imports that describes the
module's purpose, role, and numbered main flow steps.

**Rationale:** The file has a comment stub ("Source of truth: numbered MUST steps…")
but no description of what the module does or the complete execution flow. The
19-step flow directly mirrors `src/prompts/scheduler-flow.md` and is the clearest
way to help future maintainers understand the script.

**Constraints:** Documentation only — no behavioral changes.

---

## Decision 3: Add JSDoc to all internal helper functions

**Decision:** Add JSDoc (description, @param, @returns, @throws where applicable) to:
parseArgs, ts, categorizeFailureMetadata, validatePromptFile, artifactExistsSince,
verifyMemoryStep, getLatestFile, selectNextAgent, getSchedulerConfig, readRunState,
writeRunState, createIdempotencyKey, writeLog, printRunSummary, exitWithSummary.

**Rationale:** These functions are the building blocks of the scheduler loop.
Without docs, their contracts, side effects, and error modes are unclear to
contributors who did not write them.

**Constraints:** Documentation only — no changes to function signatures or behavior.

---

## Decision 4: Add targeted inline comments for non-obvious logic

**Decision:** Add inline comments at:
- Lock exit 3 handling (loop restart vs. error)
- Exclusion set fallback construction (why the union of locked/paused/completed)
- Memory file path pre-creation (why SCHEDULER_MEMORY_FILE is injected)
- Memory mode check (required vs. optional semantics)

**Rationale:** These are the spots most likely to confuse contributors doing
bug investigation or adding new validation gates.

---

## Decision 5: Create docs/scheduler-cycle-overview.md

**Decision:** Create a full overview document mirroring the style of docs/lib-overview.md.

**Rationale:** The scheduler cycle is the most complex operational entry point in TORCH.
An overview doc provides a call-flow diagram, API reference, invariant documentation,
and error path table — material that does not fit cleanly in inline comments.

**No issues opened:** No correctness problems, security issues, or design concerns found
that require maintainer decision.
